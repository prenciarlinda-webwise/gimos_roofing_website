---
// Compact version of the projects map for homepage
const projects = [
  {
    title: "Hovington Circle",
    address: "2109 Hovington Cir W, Jacksonville, FL",
    lat: 30.1897,
    lng: -81.5456,
    images: ["/images/projects/hovington-1.webp"]
  },
  {
    title: "Citron Court",
    address: "11013 Citron Ct, Jacksonville, FL",
    lat: 30.2134,
    lng: -81.5678,
    images: ["/images/projects/citron-1.webp"]
  },
  {
    title: "Gloucestershire Rd",
    address: "9092 Gloucestershire Rd, Jacksonville, FL",
    lat: 30.2456,
    lng: -81.5234,
    images: ["/images/projects/gloucestershire-1.webp"]
  },
  {
    title: "Slappy Drive",
    address: "307 NW Slappy Dr, Lake City, FL",
    lat: 30.1923,
    lng: -82.6398,
    images: ["/images/projects/slappy-1.webp"]
  }
];

const mapCenter = { lat: 30.25, lng: -81.8 };
const defaultZoom = 9;
---

<div class="projects-map-compact">
  <div id="projects-map-home" class="w-full h-[350px] md:h-[400px] rounded-xl shadow-lg"></div>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

<style>
  .project-popup-compact {
    min-width: 200px;
    max-width: 250px;
  }
  .project-popup-compact img {
    width: 100%;
    height: 140px;
    object-fit: cover;
    border-radius: 0 0 6px 6px;
  }
  .project-popup-compact .title {
    font-weight: 600;
    font-size: 0.9rem;
    color: #1a1a2e;
    padding: 10px 10px 4px;
  }
  .project-popup-compact .address {
    font-size: 0.75rem;
    color: #666;
    padding: 0 10px 8px;
  }
  .leaflet-popup-content { margin: 0; padding: 0; }
</style>

<script is:inline src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script is:inline define:vars={{ projects, mapCenter, defaultZoom }}>
  document.addEventListener('DOMContentLoaded', function() {
    const mapEl = document.getElementById('projects-map-home');
    if (!mapEl || mapEl._leaflet_id) return;

    const map = L.map('projects-map-home').setView([mapCenter.lat, mapCenter.lng], defaultZoom);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    const icon = L.divIcon({
      className: 'custom-pin',
      html: '<div style="background:#dab627;border:3px solid #1a1a2e;border-radius:50%;width:24px;height:24px;position:relative;"><div style="position:absolute;bottom:-8px;left:50%;transform:translateX(-50%);border-left:6px solid transparent;border-right:6px solid transparent;border-top:8px solid #1a1a2e;"></div></div>',
      iconSize: [24, 32],
      iconAnchor: [12, 32],
      popupAnchor: [0, -32]
    });

    projects.forEach(p => {
      const popup = `<div class="project-popup-compact">
        <div class="title">${p.title}</div>
        <div class="address">${p.address}</div>
        <img src="${p.images[0]}" alt="${p.title}" />
      </div>`;
      L.marker([p.lat, p.lng], { icon }).addTo(map).bindPopup(popup, { maxWidth: 250 });
    });
  });
</script>
